<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FÃ¼r dich â¤ï¸</title>
<style>
  /* --- Basis --- */
  :root{
    --pink:#ff6b9b;
    --pink-2:#ff85ad;
    --bg1:#ffe6f0;
    --card:#fff0f6;
    --accent:#d63384;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg,var(--bg1),#fff);
    color:var(--accent);
    -webkit-font-smoothing:antialiased;
  }
  h1,h2,p{margin:0 0 .6rem;text-align:center}
  button{background:var(--pink);border:none;color:#fff;padding:.6rem 1rem;border-radius:24px;cursor:pointer;transition:all .18s}
  button:hover{transform:scale(1.04);background:var(--pink-2)}

  /* --- Hauptboxen --- */
  .center{max-width:980px;margin:18px auto;padding:0 16px}
  .card{
    background:var(--card);
    border:2px solid #ffb6c1;
    border-radius:14px;
    padding:16px;
    box-shadow:0 6px 20px rgba(0,0,0,0.06);
    margin:12px auto;
  }
  .letter{max-width:480px;margin:12px auto;text-align:center}

  /* --- Galerie --- */
  .gallery{
    display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap;margin:12px 0;
  }
  .gallery img{width:320px;max-width:90vw;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.12);transition:transform .2s}
  .gallery img:hover{transform:scale(1.02)}

  /* --- Bottom floating menu + panels --- */
  #menuButton{
    position:fixed;right:18px;bottom:18px;width:60px;height:60px;border-radius:50%;z-index:12000;
    display:flex;align-items:center;justify-content:center;font-size:26px;
    background:var(--pink-2);box-shadow:0 8px 24px rgba(0,0,0,0.18);border:none;color:#fff;cursor:pointer;
  }
  #menuPanel{
    position:fixed;right:18px;bottom:90px;width:270px;border-radius:14px;padding:12px;display:none;
    background:var(--card);z-index:12000;border:2px solid #ffb6c1;box-shadow:0 8px 24px rgba(0,0,0,0.12);
  }
  #menuPanel.open{display:flex;flex-direction:column;gap:8px}
  #menuPanel .small{font-size:.95rem;padding:.6rem;border-radius:10px;background:#fff; border:1px solid #ffdfe8;text-align:center}

  /* --- Notes panel (wider, slides up) --- */
  #notesPanel{
    position:fixed;left:5%;right:5%;bottom:22px;height:270px;background:var(--card);border-radius:14px;padding:10px;display:none;z-index:11999;
    box-shadow:0 8px 30px rgba(0,0,0,0.12);border:2px solid #ffb6c1;
  }
  #notesPanel.open{display:flex;flex-direction:column;}
  #notesPanel textarea{flex:1;border-radius:10px;border:1px solid #ffb6c1;padding:10px;font-family:inherit}

  /* --- Login panel --- */
  #authPanel{max-width:360px;margin:10px auto;padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:8px}
  #authPanel input{padding:10px;border-radius:8px;border:1px solid #ffdfe8;font-size:1rem}

  /* --- Heart style (created dynamically) --- */
  .heart{
    position:fixed;z-index:11000;pointer-events:auto;user-select:none;will-change:transform,opacity;
  }

  /* --- Responsive --- */
  @media (max-width:600px){
    .gallery img{width:88vw}
    #menuPanel{right:6%;width:88%}
    #menuButton{right:6%}
    #notesPanel{left:4%;right:4%;height:220px}
  }
</style>
</head>
<body>
  <div class="center">
    <h1>ğŸ’– FÃ¼r dich bububÃ¤r ğŸ’–</h1>
    <p style="text-align:center;margin-bottom:6px">Diese Seite ist fÃ¼r dich gemacht, weil ich dich ganz doll liebi ğŸ’</p>

    <!-- Letter -->
    <div class="card letter">
      <h2>ğŸ’Œ 13 (or more) reasons why</h2>
      <p id="letterText">Ein Bruchteil der GrÃ¼nde wieso ich dich liebe.</p>
      <div style="margin-top:10px">
        <button id="showReasonBtn">Zeig mir einen Grund ğŸ’•</button>
      </div>
    </div>

    <!-- Countdown -->
    <div class="card" style="text-align:center">
      <h2>ğŸ—“ï¸ Countdown bis wir uns sehi:</h2>
      <div id="countdown" style="font-size:1.05rem;margin-top:8px;color:#ff5c8d">...</div>
    </div>

    <!-- Gallery -->
    <div class="card">
      <h2 style="margin-bottom:8px">ğŸ“¸ Leos und Mios besten Bilder</h2>
      <div class="gallery">
        <img id="randomImage" src="" alt="Random Bild">
      </div>
      <div style="text-align:center"><button id="changeImageBtn">Bild wechseln ğŸ’•</button></div>
    </div>

    <!-- Game (yes/no) -->
    <div class="card" style="text-align:center">
      <h2>Bin ich der allertollste Freund auf dieser Welt? ğŸ’•</h2>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
        <button id="yesBtn">Ja du geiler</button>
        <button id="noBtn">Nein!!!</button>
      </div>
    </div>

    <footer style="margin:18px 0;text-align:center;color:#888">Mit Liebe gemacht von justini bananini ğŸ’•</footer>
  </div>

  <!-- Floating menu button + panel -->
  <button id="menuButton">ğŸ’–</button>
  <div id="menuPanel" aria-hidden="true">
    <!-- Pill reminder -->
    <div id="pillReminder" class="small">
      <div id="pillTitle">ğŸ’Š Nimm die Pille grrrr!</div>
      <div id="pillCountdown" style="font-size:.95rem;color:#ff5c8d;margin-top:6px"></div>
      <div style="margin-top:8px"><button id="pillTakenBtn">Hab genommi ğŸ˜‡</button></div>
    </div>

    <!-- love counter & actions -->
    <div id="loveCounter" class="small">Liebe: 0 ğŸ’–</div>
    <div style="display:flex;gap:8px">
      <button id="addHeartBtn" style="flex:1">Herz manuell +1</button>
      <button id="openNotesBtn" style="flex:1">ğŸ“</button>
    </div>

    <!-- shop -->
    <button id="loveShopBtn" class="small">Love Shop ğŸ’•</button>

    <!-- auth / login -->
    <div id="authControls" style="margin-top:8px"></div>

    <!-- leaderboard -->
    <div id="leaderboard" style="margin-top:6px">
      <h4 style="margin:6px 0;text-align:left;font-size:1rem">Leaderboard ğŸ’–</h4>
      <ol id="leaderboardList" style="padding-left:16px;margin:0 0 8px 0"></ol>
    </div>
  </div>

  <!-- Notes panel -->
  <div id="notesPanel" aria-hidden="true">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 8px">
      <h3 style="margin:0">Paladins Ideen ğŸ’¡</h3>
      <button id="closeNotesBtn" style="background:#ffb6c1;color:#fff;padding:6px 10px;border-radius:10px">SchlieÃŸen</button>
    </div>
    <textarea id="notesArea" placeholder="Schreib deine Ideen hier rein..." aria-label="Notizen"></textarea>
  </div>

  <!-- Firebase (compat libs) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
  /***** --- Firebase config (falls du andere Daten hast, ersetze sie) --- *****/
  const firebaseConfig = {
    apiKey: "AIzaSyDJl-UVkVFCj-CfDiXcYBbVRoT9WpboXOs",
    authDomain: "nathalie-notizen-webseite.firebaseapp.com",
    projectId: "nathalie-notizen-webseite",
    storageBucket: "nathalie-notizen-webseite.firebasestorage.app",
    messagingSenderId: "627451220911",
    appId: "1:627451220911:web:63357b6799f075bacfd55a"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  /***** --- UI references --- *****/
  const menuButton = document.getElementById("menuButton");
  const menuPanel = document.getElementById("menuPanel");
  const notesPanel = document.getElementById("notesPanel");
  const openNotesBtn = document.getElementById("openNotesBtn");
  const closeNotesBtn = document.getElementById("closeNotesBtn");
  const notesArea = document.getElementById("notesArea");

  const loveCounterEl = document.getElementById("loveCounter");
  const leaderboardList = document.getElementById("leaderboardList");
  const loveShopBtn = document.getElementById("loveShopBtn");
  const addHeartBtn = document.getElementById("addHeartBtn");

  const pillTitle = document.getElementById("pillTitle");
  const pillCountdown = document.getElementById("pillCountdown");
  const pillTakenBtn = document.getElementById("pillTakenBtn");

  const authControls = document.getElementById("authControls");

  const randomImage = document.getElementById("randomImage");
  const changeImageBtn = document.getElementById("changeImageBtn");

  /***** --- App state --- *****/
  let currentUser = null;
  let lovePoints = 0;
  let saveLoveTimeout = null; // debounce
  let heartIntervalId = null;

  /***** --- Useful helpers --- *****/
  function setLoveDisplay(){
    loveCounterEl.textContent = `Liebe: ${lovePoints} ğŸ’–`;
  }
  function saveLoveToFirestore(){
    if(!currentUser) return;
    const ref = db.collection("users").doc(currentUser.uid);
    ref.set({ love: lovePoints }, { merge: true }).catch(console.error);
  }
  function debounceSaveLove(){
    if(saveLoveTimeout) clearTimeout(saveLoveTimeout);
    saveLoveTimeout = setTimeout(saveLoveToFirestore, 800);
  }

  /***** --- Auth UI: own email/password form + signout --- *****/
  function renderAuthControls(user){
    authControls.innerHTML = ""; // clear
    if(user){
      // show user + sign out
      const div = document.createElement("div");
      div.style.display = "flex"; div.style.flexDirection = "column"; div.style.gap = "6px";
      const who = document.createElement("div");
      who.textContent = `Angemeldet: ${user.email}`;
      who.style.fontSize = ".95rem"; who.style.color = "#8a2b54";
      const outBtn = document.createElement("button");
      outBtn.textContent = "Abmelden";
      outBtn.addEventListener("click", ()=> auth.signOut());
      div.appendChild(who); div.appendChild(outBtn);
      authControls.appendChild(div);
    } else {
      // build simple sign-in / register form
      const form = document.createElement("div");
      form.style.display="flex"; form.style.flexDirection="column"; form.style.gap="6px";

      const email = document.createElement("input");
      email.type = "email"; email.placeholder = "E-Mail";

      const pass = document.createElement("input");
      pass.type = "password"; pass.placeholder = "Passwort";

      const signInBtn = document.createElement("button");
      signInBtn.textContent = "Anmelden";
      signInBtn.addEventListener("click", ()=>{
        const e=email.value.trim(), p=pass.value;
        if(!e||!p){ alert("Bitte E-Mail und Passwort angeben"); return; }
        auth.signInWithEmailAndPassword(e,p).catch(err=>alert("Fehler: "+err.message));
      });

      const signUpBtn = document.createElement("button");
      signUpBtn.textContent = "Neu registrieren";
      signUpBtn.style.background="#ffd4e3"; signUpBtn.style.color="#8a2b54";
      signUpBtn.addEventListener("click", ()=>{
        const e=email.value.trim(), p=pass.value;
        if(!e||!p){ alert("Bitte E-Mail und Passwort angeben"); return; }
        auth.createUserWithEmailAndPassword(e,p).catch(err=>alert("Fehler: "+err.message));
      });

      form.appendChild(email); form.appendChild(pass); form.appendChild(signInBtn); form.appendChild(signUpBtn);
      authControls.appendChild(form);
    }
  }

  /***** --- On auth change: sync data, enable features ---*****/
  auth.onAuthStateChanged(async user=>{
    currentUser = user;
    renderAuthControls(user);
    if(user){
      // load user love points
      try{
        const doc = await db.collection("users").doc(user.uid).get();
        lovePoints = (doc.exists && doc.data().love) ? doc.data().love : 0;
        setLoveDisplay();
      }catch(e){ console.error(e); }

      // load notes
      try{
        const notesDoc = await db.collection("notes").doc(user.uid).get();
        notesArea.value = (notesDoc.exists && notesDoc.data().text) ? notesDoc.data().text : "";
      }catch(e){ console.error(e); }

      // start heart rain & leaderboard
      startHeartRain();
      updateLeaderboard();
      // listen for real-time leaderboard (optional)
      // you can use onSnapshot if you want live updates; here we poll every 60s:
      setInterval(updateLeaderboard, 60000);
    } else {
      lovePoints = 0;
      setLoveDisplay();
      notesArea.value = "";
      stopHeartRain();
      updateLeaderboard(); // show top public (will be zero locally)
    }
  });

  /***** --- Hearts: floating, clickable, saved per user ---*****/
  function createHeartOnce(){
    // small function to generate one heart element at random horizontal pos at top
    const heart = document.createElement("div");
    heart.className = "heart";
    heart.textContent = "ğŸ’–";
    const size = Math.floor(Math.random()*28)+16;
    heart.style.fontSize = size + "px";
    // place slightly inside viewport
    const left = Math.random()*(window.innerWidth - 80) + 20;
    heart.style.left = left + "px";
    heart.style.top = "-40px";
    document.body.appendChild(heart);

    // clicking the heart increments love (only while logged in)
    heart.style.cursor = "pointer";
    heart.addEventListener("click", (e)=>{
      e.stopPropagation();
      // increment
      if(currentUser){
        lovePoints += 1;
        setLoveDisplay();
        debounceSaveLove();
        heart.remove();
      } else {
        alert("Bitte zuerst anmelden, damit Punkte gespeichert werden.");
      }
    });

    // animate falling
    const endY = window.innerHeight + 80;
    const duration = Math.random()*3500 + 3000;
    let start=null;
    function animate(ts){
      if(!start) start = ts;
      const progress = (ts - start) / duration;
      const y = Math.min(progress * endY, endY);
      heart.style.transform = `translateY(${y}px) rotate(${progress*360}deg)`;
      heart.style.opacity = `${1 - progress}`;
      if(progress < 1) requestAnimationFrame(animate);
      else heart.remove();
    }
    requestAnimationFrame(animate);
  }

  function startHeartRain(){
    // avoid multiple intervals
    if(heartIntervalId) return;
    createHeartOnce(); // immediate
    heartIntervalId = setInterval(createHeartOnce, 900);
  }
  function stopHeartRain(){
    if(heartIntervalId){ clearInterval(heartIntervalId); heartIntervalId = null; }
    // remove any remaining hearts
    document.querySelectorAll(".heart").forEach(h=>h.remove());
  }

  // manual add heart
  addHeartBtn.addEventListener("click", ()=>{
    if(!currentUser){ alert("Bitte anmelden, um Punkte zu speichern."); return; }
    lovePoints += 1; setLoveDisplay(); debounceSaveLove();
  });

  /***** --- Leaderboard ---*****/
  async function updateLeaderboard(){
    leaderboardList.innerHTML = "<li>ladeâ€¦</li>";
    try{
      const q = await db.collection("users").orderBy("love","desc").limit(5).get();
      leaderboardList.innerHTML = "";
      q.forEach(doc=>{
        const li = document.createElement("li");
        // show email (if you prefer nicer display, you can store a displayName)
        const name = doc.id === (currentUser && currentUser.uid) ? "Du" : (doc.data().displayName || doc.id.slice(0,6));
        li.textContent = `${name}: ${doc.data().love || 0} ğŸ’–`;
        leaderboardList.appendChild(li);
      });
      if(leaderboardList.children.length===0) leaderboardList.innerHTML = "<li>noch keiner</li>";
    }catch(e){ console.error(e); leaderboardList.innerHTML = "<li>Fehler</li>"; }
  }

  /***** --- Notes saving ---*****/
  // save notes to Firestore for current user (debounced)
  let notesSaveTimeout = null;
  notesArea.addEventListener("input", ()=>{
    if(!currentUser) return;
    if(notesSaveTimeout) clearTimeout(notesSaveTimeout);
    notesSaveTimeout = setTimeout(()=>{
      db.collection("notes").doc(currentUser.uid).set({ text: notesArea.value }).catch(console.error);
    }, 700);
  });

  /***** --- Love Shop (simple) ---*****/
  function buyItem(cost, name){
    if(!currentUser){ alert("Bitte anmelden, um etwas zu kaufen."); return; }
    if(lovePoints >= cost){
      lovePoints -= cost; setLoveDisplay(); debounceSaveLove();
      alert(`Du hast ${name} gekauft ğŸ’•`);
    } else alert("Nicht genug Liebe ğŸ’–");
  }
  // attach simple shop UI on click
  loveShopBtn.addEventListener("click", ()=>{
    const shopHtml = `
      <div style="display:flex;flex-direction:column;gap:8px">
        <button id="b1">Mini Date - 10 ğŸ’–</button>
        <button id="b2">Ice Cream Date - 25 ğŸ’–</button>
        <button id="b3">Movie Date - 50 ğŸ’–</button>
      </div>
    `;
    // simple inline dialog using confirm-like behavior
    const box = document.createElement("div");
    box.style.position="fixed"; box.style.left="50%"; box.style.top="50%"; box.style.transform="translate(-50%,-50%)";
    box.style.zIndex=13000; box.style.padding="14px"; box.style.borderRadius="12px"; box.style.background="#fff0f6";
    box.style.border="2px solid #ffb6c1"; box.innerHTML = shopHtml;
    document.body.appendChild(box);
    box.addEventListener("click", (e)=>{
      if(e.target.id==="b1"){ buyItem(10,"Mini Date"); box.remove(); }
      if(e.target.id==="b2"){ buyItem(25,"Ice Cream Date"); box.remove(); }
      if(e.target.id==="b3"){ buyItem(50,"Movie Date"); box.remove(); }
    });
    // click outside to close
    setTimeout(()=>{ window.addEventListener("click", function closer(ev){ if(!box.contains(ev.target)){ box.remove(); window.removeEventListener("click",closer); } }); }, 100);
  });

  /***** --- Pill reminder logic ---*****/
  function updatePillCountdown(){
    const now = new Date();
    const pillTime = new Date();
    pillTime.setHours(20,0,0,0);
    if(now > pillTime) pillTime.setDate(pillTime.getDate()+1);
    const diff = pillTime - now;
    const hours = Math.floor(diff/3600000);
    const mins = Math.floor((diff/60000)%60);
    const lastTaken = localStorage.getItem("pillTakenDate");
    const today = new Date().toDateString();
    if(lastTaken === today){
      pillTitle.textContent = "âœ… Schon genommi heute!";
      pillCountdown.textContent = `NÃ¤chste in ${hours}h ${mins}m ğŸ’—`;
    } else if(now.getHours() >= 20){
      pillTitle.textContent = "ğŸ’Š Nimm die Pille ml!!!!";
      pillCountdown.textContent = "Jetzt ist Zeit ğŸ’–";
    } else {
      pillTitle.textContent = "Pille spÃ¤ti nehmi:";
      pillCountdown.textContent = `Noch ${hours}h ${mins}m ğŸ’`;
    }
  }
  setInterval(updatePillCountdown, 30000);
  updatePillCountdown();
  pillTakenBtn.addEventListener("click", ()=>{
    localStorage.setItem("pillTakenDate", new Date().toDateString());
    updatePillCountdown();
  });

  /***** --- Menu + Panels interactions ---*****/
  menuButton.addEventListener("click", ()=> menuPanel.classList.toggle("open"));
  openNotesBtn.addEventListener("click", ()=> { notesPanel.classList.add("open"); notesPanel.style.display="flex"; });
  closeNotesBtn.addEventListener("click", ()=> { notesPanel.classList.remove("open"); notesPanel.style.display="none"; });

  /***** --- Reasons & Countdown & small features ---*****/
  const reasons = [
    "Du bist die erste Person, die ich immer bei mir will.",
    "Du bist das erste, an das ich morgens denke.",
    "Du hast so lange auf mich gewartet <3.",
    "Du bist so sÃ¼ÃŸ und lieb.",
    "Du machst mich einfach glÃ¼cklich.",
    "Du bist der Grund, warum ich lÃ¤chle.",
    "Ich liebe deine Art zu lachen.",
    "Ich freue mich jedes Mal, dich zu sehen.",
    "Du bist wunderschÃ¶n.",
    "Ich bin so stolz, dass du meins bist.",
    "Deine Augen sind so wunderschÃ¶n"
  ];
  document.getElementById("showReasonBtn").addEventListener("click", ()=> {
    document.getElementById("letterText").textContent = reasons[Math.floor(Math.random()*reasons.length)];
  });

  // Countdown to a fixed date (you can change)
  const targetDate = new Date("2025-10-24T20:00:00");
  const countdownEl = document.getElementById("countdown");
  function updateCountdown(){
    const now = new Date();
    const diff = targetDate - now;
    if(diff <= 0){ countdownEl.textContent = "Endlich sehi ğŸ’•"; return; }
    const days = Math.floor(diff/(1000*60*60*24));
    const hours = Math.floor((diff/(1000*60*60))%24);
    const mins = Math.floor((diff/(1000*60))%60);
    const secs = Math.floor((diff/1000)%60);
    countdownEl.textContent = `${days} Tage, ${hours} Std, ${mins} Min, ${secs} Sek`;
  }
  setInterval(updateCountdown, 1000);
  updateCountdown();

  // yes/no button fun
  const noBtn = document.getElementById("noBtn");
  const yesBtn = document.getElementById("yesBtn");
  if(noBtn){
    noBtn.addEventListener("mouseover", ()=>{
      noBtn.style.position="absolute";
      noBtn.style.left = Math.random()*65 + "%";
      noBtn.style.top = Math.random()*65 + "%";
    });
  }
  if(yesBtn) yesBtn.addEventListener("click", ()=> alert("Yaaay ğŸ’– Du hast bestimmt nicht versucht, den Nein-Button zu drÃ¼cken..."));

  /***** --- Gallery images ---*****/
  const images = ["https://i.imgur.com/m05eQGf.jpeg","https://i.imgur.com/rp80WsN.jpeg","https://i.imgur.com/BIxd6ix.jpeg"];
  function setRandomImage(){ randomImage.src = images[Math.floor(Math.random()*images.length)]; }
  changeImageBtn.addEventListener("click", setRandomImage);
  setRandomImage();

  /***** --- Clean unload: save love before leaving ---*****/
  window.addEventListener("beforeunload", ()=>{
    if(currentUser) saveLoveToFirestore();
  });

  /***** --- Initial render of auth controls (no user yet) ---*/
  renderAuthControls(null);

  </script>
</body>
</html>

